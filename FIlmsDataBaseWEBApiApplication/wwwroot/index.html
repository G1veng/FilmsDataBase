<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Зая</title>
    <script src="jquery-3.6.0.min.js"></script>
    <script src="require.js"></script>
    <link rel="stylesheet" href="StyleSheet.css" />
</head>
<body>
    <div>

        <textarea type="text" id="identificationNumber" class="identificationNumber"></textarea>
        <textarea type="text" id="title" class="filmsToSaveData"></textarea>
        <textarea type="text" id="description" class="filmsToSaveData"></textarea>
        <textarea type="text" id="trailer" class="trailer"></textarea>
        <textarea type="text" id="icon" class="icon"></textarea>
        <textarea type="datetime" id="year" class="filmsToSaveData">2012-04-30T02:20:22.20</textarea>
        <button id="saveFilm">Save film</button>
        <button id="deleteFilm">Delete film</button>
        <button id="editFilm">Edit film</button>
        <input type="file" id="logo" onchange="GetUrlOfImage()">
        <img src="BlueSmile.jpg" alt="Blue smile" width="200" height="200" id="myImage" />
    </div>
    <div class="films" id="films">

    </div>
    <script type="text/javascript" lang="en">
        $(document).ready(function () {
            GetAllFilms();
            $("#saveFilm").click(function () {
                AddFilm();
            });
            $("#deleteFilm").click(function () {
                DeleteFilm();
            });
            $("#editFilm").click(function () {
                EditFilm();
            });
            
        });
        function GetAllFilms() {
            $("#films").empty();
            $.getJSON({
                url: "film",
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    ShowFilms(data);
                },
            });
        }
        function GetUrlOfImage() {
            let image = document.getElementById('logo').files[0];
            let reader = new FileReader();
            reader.readAsDataURL(image);
            let setImage = document.getElementById('myImage');
            reader.onload = function () {
                setImage.src = reader.result;
                let imageLink = document.getElementById('icon');
                imageLink.value = reader.result;
                define(function (require) {
                    var namedModule = require('fs');
                    namedModule.copyFile(document.getElementById('logo').value, 'D:\\4 семестр\\РПС\\FilmsDataBase\\FIlmsDataBaseWEBApiApplication\\wwwroot\\image.jpg', (err) => {
                        if (err) throw err;
                        console.log('source.txt was copied to destination.txt');
                    });
                });
            }
        }
        function ShowFilms(books) {
            $(books).each(function (index, book) {
                var htmlString = "<label>Id: " + book.id + "</label><label>Title: "
                    + book.title + "</label><label>Description: " + book.description + "</label><img=" + book.icon + "alt=" + book.icon + "/><label>Trailer: "
                    + book.trailer + "</label><br/><label>Year: " + book.year + "</label>";
                $('.films').append(htmlString);
                console.log(book);
            });
        }
        function AddFilm() {
            if (WriteOffFilm() == null)
                return;
            console.log(WriteOffFilm());
            $.ajax({
                url: 'film',
                type: 'POST',
                data: JSON.stringify(WriteOffFilm()),
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    GetAllFilms();
                },
                
            });
        }
        function DeleteFilm() {
            $.ajax({
                url: 'film/' + GetIdentificationNumber(),
                type: 'DELETE',
                success: function (data) {
                    GetAllFilms();
                },
                error: function (data) {
                    alert("Error");
                    console.log(data);
                }
            });
        }
        function EditFilm() {
            $.ajax({
                url: 'film/' + GetIdentificationNumber(),
                type: 'PUT',
                data: JSON.stringify(WriteOffFilmWithId()),
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    GetAllFilms();
                },
                error: function (data) {
                    GetAllFilms();
                }
            });
        }
        function GetIdentificationNumber() {
            let identificationNumberArea = document.getElementById("identificationNumber");
            return identificationNumberArea.value;
        }
        function GetTitle() {
            let titleArea = document.getElementById("title");
            return titleArea.value;
        }
        function GetDescription() {
            let descriptionArea = document.getElementById("description");
            return descriptionArea.value;
        }
        function GetTrailer() {
            let trailerArea = document.getElementById("description");
            return trailerArea.value;
        }
        function GetTrailer() {
            let iconArea = document.getElementById("icon");
            return iconArea.value;
        }
        function GetYear() {
            let yearArea = document.getElementById("year");
            return yearArea.value;
        }
        function GetIcon() {
            let iconArea = document.getElementById("icon");
            return iconArea.value;
        }
        function WriteOffFilm() {
            var book = {
                title: GetTitle(),
                description: GetDescription(),
                icon: GetIcon(),
                trailer: GetTrailer(),
                year: GetYear()
            }
            return book;
        }
        function WriteOffFilmWithId(){
            var book = {
                id: GetIdentificationNumber(),
                title: GetTitle(),
                description: GetDescription(),
                icon: GetIcon(),
                trailer: GetTrailer(),
                year: GetYear()
            }
            return book;
        }
    </script>
</body>
</html>
